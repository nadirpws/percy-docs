# Percy for Ember
#### [ember-percy on GitHub <i class="fa fa-github" aria-hidden="true"></i>](https://github.com/percy/ember-percy)

[![Package Status](https://img.shields.io/npm/v/ember-percy.svg)](https://www.npmjs.com/package/ember-percy)
[![Build Status](https://travis-ci.org/percy/ember-percy.svg?branch=master)](https://travis-ci.org/percy/ember-percy)

Ember addon for visual regression testing with [Percy](https://percy.io).

## Installation

[!INCLUDE /docs/clients/-do-setup-first]

Requires Node >= 0.12.0.
Requires `ember-cli` >= 1.13.13, preferably >= 2.4.0.

1. `ember install ember-percy`
1. Add `import './percy/register-helpers';` to `tests/helpers/start-app.js`. This registers the Percy test helpers for all acceptance tests.
1. Add `"globals": {"percySnapshot": true}` to `tests/.eslintrc` to avoid "percySnapshot is not defined" errors.

## Usage

```javascript
percySnapshot(name);
percySnapshot(name, options);
```

`options` is an optional hash that can include:

* `scope`: A CSS selector or element to snapshot. Defaults to the full page.

Examples:

```javascript
percySnapshot('homepage');
```

```javascript
percySnapshot('homepage', {scope: '#header'});
```

### Autogenerated name for Mocha tests

You can pass `this.test` to autogenerate the snapshot name, for example:

```javascript
percySnapshot(this.test);
```

This will automatically name the snapshot from the test title, like _"Acceptance: Marketing pages can visit /about"_.

### Autogenerated name for QUnit tests

You can pass the `assert` object to autogenerate the snapshot name, for example:

```javascript
percySnapshot(assert);
```

This will automatically name the snapshot from the test title, like _"Acceptance | Marketing pages | can visit /about"_.

### Acceptance test example

```javascript
describe('Acceptance: Marketing pages', function() {
  it('can visit /about', function() {
    visit('/about');
    percySnapshot('about page');

    click('#person1');
    percySnapshot('about page (person details)');
  });
});
```

### Component integration test example

```javascript
import { percySnapshot } from 'ember-percy';

describeComponent(
  'meter-bar',
  'Integration: MeterBarComponent',
  {
    integration: true
  },
  function() {
    it('renders', function() {
      this.set('count', 0);
      this.render(hbs`{{meter-bar count=count total=100}}`);
      percySnapshot('meter bar zero');

      this.set('count', 50);
      percySnapshot('meter bar half');

      this.set('count', 100);
      percySnapshot('meter bar full');
    });
  }
);
```

## Freezing time and dynamic data

As you start to introduce visual testing into your workflow, you might find that the passing of time or generated data from tools like [faker](https://github.com/marak/Faker.js/) can cause visual diffs.

It's fairly easy to stabilize these diffs. Tools like faker often allow you to provide a [seed](https://github.com/marak/Faker.js/#setting-a-randomness-seed) to ensure that the same data is generated each time faker is run. Libraries like [ember-mockdate-shim](https://github.com/Ticketfly/ember-mockdate-shim) allow you to override the current date, eliminating variations due to the screenshots being taking at a different date and time. If you use Math.random, you can seed it with [seedrandom](https://github.com/davidbau/seedrandom).

## Separate build and test steps
If you're running your ember tests with the `--path` flag to test an app pre-built with `ember build -o`, you may need to
modify your commands to ensure the test environment is setup correctly.

In your `ember build` command, use the `--environment=test` flag:
```bash
ember build --environment=test -o dist
```

Run your `ember test` command with the `EMBER_ENV` variable set to test:
```bash
EMBER_ENV=test ember test --path=dist
```

## Ember Exam
If you use Ember Exam ([ember-exam](https://github.com/trentmwillis/ember-exam)) your Percy setup may require custom adjustments. Please email your Ember Exam configuration to [hello@percy.io](mailto:hello@percy.io), and we will advise how to get Percy running.

## Responsive visual diff setup

You can use Percy [responsive visual diffs](/docs/learn/responsive) to test at different CSS breakpoints.

In your app's `config/environment.js`:

```javascript
if (environment === 'test') {
  // ...
  ENV.percy = {
    breakpointsConfig: {
      mobile: 375,
      tablet: 768,
      desktop: 1280
    },
    defaultBreakpoints: ['mobile', 'desktop']
  }
}
```

With the above configuration, all snapshots will render at both the `mobile` and `desktop`
breakpoints by default.

You can override this on a per-snapshot basis by passing the `breakpoints` option to `percySnapshot()`.
For example:

```javascript
// Desktop-only snapshot:
percySnapshot('meter bar full', {breakpoints: ['desktop']});
```

## GitHub integration

Percy **automatically integrates with GitHub PRs**, so you can do visual reviews with each PR's code review.

![](https://cloud.githubusercontent.com/assets/75300/13929974/13750b2c-ef5a-11e5-9a87-3ad3b335cc0d.png)

See our [GitHub integration](/docs/integrations/github) docs for more info.

## Troubleshooting

  * Missing fonts in Percy? Make sure that your `tests/index.html` mirrors your main `index.html` file. You should include any fonts or external stylesheets in both places.

## Other resources

<iframe style="max-width: 1000px" width="100%" height="563" src="https://www.youtube-nocookie.com/embed/iECnXK9EqA4" frameborder="0" allowfullscreen></iframe>

* EmberSF meetup video: [Continuous Visual Integration for Ember by Mike Fotinakis](https://www.youtube.com/watch?v=iECnXK9EqA4)
* EmberScreencasts video: [Introduction to Visual Regression Testing](https://www.emberscreencasts.com/posts/160)

## Contributing

1. Fork it ( https://github.com/percy/ember-percy/fork )
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create a new pull request

[Throw a â˜… on it!](https://github.com/percy/ember-percy) :)
